<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>equeum-graphql-server</title><meta name="description" content="Documentation for equeum-graphql-server"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">equeum-graphql-server</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>equeum-graphql-server</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#equeum-graphql-server" id="equeum-graphql-server" style="color: inherit; text-decoration: none;">
  <h1>Equeum GraphQL Server</h1>
</a>
<p>Implementation of GraphQL server. Takes in type definitions and resolvers and configures GraphQL server with authenticated user data in context and other standard things. Apollo Federation ready. Also exports Equeum specific type definitions.</p>

<a href="#requirements" id="requirements" style="color: inherit; text-decoration: none;">
  <h2>Requirements</h2>
</a>
<p>Scripts inside package.json rely on <a href="https://www.npmjs.com/package/npx">npx</a> to be installed globally. To install it run:</p>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">install</span><span class="hl-1"> -</span><span class="hl-0">g</span><span class="hl-1"> </span><span class="hl-0">npx</span>
</code></pre>
<p>You also need EqueumRESTServer as it provides standard implementation for web service and provides authentification and security.</p>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">install</span><span class="hl-1"> </span><span class="hl-0">git</span><span class="hl-1">+</span><span class="hl-2">ssh</span><span class="hl-1">:</span><span class="hl-3">//github.com/equeumco/equeum-rest-server.git</span>
</code></pre>

<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
  <h2>Installation</h2>
</a>
<p>To ensure the stability of our services we always specify exact version of the library that we are including. Therefore we are sure that &#39;npm install&#39; will always install the same version no matter what. Developers then need to update the version for each service manually when that is needed (or together with routinely updating all outdated third-party packages).</p>
<pre><code><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-0">install</span><span class="hl-1"> </span><span class="hl-0">git</span><span class="hl-1">+</span><span class="hl-2">https</span><span class="hl-1">:</span><span class="hl-3">//github.com/equeumco/equeum-graphql-server#X.Y.Z</span>
</code></pre>
<p>Where &#39;X.Y.Z&#39; is the <a href="../../releases/latest">latest version of the library</a>.</p>

<a href="#working-example" id="working-example" style="color: inherit; text-decoration: none;">
  <h2>Working example</h2>
</a>
<pre><code><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-0">express</span><span class="hl-1">, { </span><span class="hl-0">Router</span><span class="hl-1">, </span><span class="hl-0">Request</span><span class="hl-1">, </span><span class="hl-0">Response</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-5">&#39;express&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-0">EqueumRESTServer</span><span class="hl-1"> </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-5">&#39;equeum-rest-server&#39;</span><span class="hl-1">;</span><br/><span class="hl-4">import</span><span class="hl-1"> </span><span class="hl-0">EqueumGraphQLServer</span><span class="hl-1"> </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-5">&#39;equeum-graphql-server&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">app</span><span class="hl-1"> = </span><span class="hl-8">express</span><span class="hl-1">();</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">typeDefs</span><span class="hl-1"> = </span><span class="hl-5">`</span><br/><span class="hl-5">  type Query {</span><br/><span class="hl-5">    testQuery: String</span><br/><span class="hl-5">  }</span><br/><span class="hl-5">`</span><span class="hl-1">;</span><br/><br/><span class="hl-6">const</span><span class="hl-1"> </span><span class="hl-7">resolvers</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-0">Query:</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-8">testQuery</span><span class="hl-0">:</span><span class="hl-1"> () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-5">&#39;Test response&#39;</span><br/><span class="hl-1">  }</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-8">EqueumRESTServer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">app</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-3">// We need to pass this here to make sure /graphql route is just checked for auth</span><br/><span class="hl-1">  </span><span class="hl-3">// but not handled by REST server and left for GraphQL server</span><br/><span class="hl-1">  </span><span class="hl-0">passThroughRoutes:</span><span class="hl-1"> [</span><span class="hl-5">&#39;/graphql&#39;</span><span class="hl-1">],</span><br/><span class="hl-1">  </span><span class="hl-0">addAuthToRoutes:</span><span class="hl-1"> [</span><span class="hl-5">&#39;/graphql</span><span class="hl-9">]</span><br/><span class="hl-1">});</span><br/><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-8">EqueumGraphQLServer</span><span class="hl-1">({</span><br/><span class="hl-1">  </span><span class="hl-0">app</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">typeDefs</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-0">resolvers</span><br/><span class="hl-1">});</span><br/><br/><span class="hl-0">const</span><span class="hl-1"> </span><span class="hl-0">port</span><span class="hl-1">: </span><span class="hl-0">number</span><span class="hl-1"> = </span><span class="hl-10">4000</span><span class="hl-1">;</span><br/><span class="hl-0">app</span><span class="hl-1">.</span><span class="hl-8">listen</span><span class="hl-1">(</span><span class="hl-0">port</span><span class="hl-1">, () </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-0">console</span><span class="hl-1">.</span><span class="hl-8">log</span><span class="hl-1">(</span><span class="hl-5">`Server is listening on http://localhost:</span><span class="hl-6">${</span><span class="hl-0">port</span><span class="hl-6">}</span><span class="hl-5">`</span><span class="hl-1">));</span>
</code></pre>
<p>If using <a href="https://typegraphql.ml/">TypeGraphQL</a> for automatically generating schema you first build type definitions and resolvers and then pass them to the constructor.</p>
<pre><code><span class="hl-4">import</span><span class="hl-1"> { </span><span class="hl-0">buildTypeDefsAndResolvers</span><span class="hl-1"> } </span><span class="hl-4">from</span><span class="hl-1"> </span><span class="hl-5">&#39;type-graphql&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">buildTypeDefsAndResolvers</span><span class="hl-1">({ </span><span class="hl-0">resolvers:</span><span class="hl-1"> [ ... ] }).</span><span class="hl-8">then</span><span class="hl-1">(({ </span><span class="hl-0">typeDefs</span><span class="hl-1">, </span><span class="hl-0">resolvers</span><span class="hl-1"> }) </span><span class="hl-6">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-6">new</span><span class="hl-1"> </span><span class="hl-8">EqueumGraphQLServer</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-0">app</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">typeDefs</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-0">resolvers</span><span class="hl-1">,</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code></pre>

<a href="#equeumgraphqlserver-default-export" id="equeumgraphqlserver-default-export" style="color: inherit; text-decoration: none;">
  <h2>EqueumGraphQLServer (default export)</h2>
</a>
<p>Main class containing GraphQL server implementation. <a href="#working-example">Working example</a> has copy-paste ready code to bootsrap the server.</p>

<a href="#authentification" id="authentification" style="color: inherit; text-decoration: none;">
  <h3>Authentification</h3>
</a>
<p>EqueumGraphQL server relies on EqueumRESTServer to verify JWT token and add user data to request object. It expects all requests that pass REST server auth middleware to be authenticated. It then reads user data from request object and populates GraphQL context with that data.</p>

<a href="#constructor-parameters" id="constructor-parameters" style="color: inherit; text-decoration: none;">
  <h3>Constructor Parameters</h3>
</a>

<a href="#app-application" id="app-application" style="color: inherit; text-decoration: none;">
  <h4>app: Application</h4>
</a>
<p>Express app object to build the server over</p>

<a href="#typedefs-any" id="typedefs-any" style="color: inherit; text-decoration: none;">
  <h4>typeDefs: any</h4>
</a>
<p>GraphQL type definitions</p>

<a href="#resolvers-iresolversltany-anygt--iresolversltany-anygt" id="resolvers-iresolversltany-anygt--iresolversltany-anygt" style="color: inherit; text-decoration: none;">
  <h4>resolvers: IResolvers&lt;any, any&gt; | IResolvers&lt;any, any&gt;[]</h4>
</a>
<p>Resolver functions</p>

<a href="#loaders--key-string-dataloaderltstring-anygt-" id="loaders--key-string-dataloaderltstring-anygt-" style="color: inherit; text-decoration: none;">
  <h4>loaders: { [key: string]: DataLoader&lt;string, any&gt; }</h4>
</a>
<p>Custom data loaders. We use <a href="https://github.com/graphql/dataloader">DataLoader</a> utility to batch and optimise resolving queries. Loaders passed here will be added to context and available to use in your resolvers.</p>

<a href="#types" id="types" style="color: inherit; text-decoration: none;">
  <h2>Types</h2>
</a>

<a href="#equeumcontext" id="equeumcontext" style="color: inherit; text-decoration: none;">
  <h3>EqueumContext</h3>
</a>
<p>This type defines context that will be available inside each resolver.</p>

<a href="#decorators" id="decorators" style="color: inherit; text-decoration: none;">
  <h2>Decorators</h2>
</a>

<a href="#requirerole" id="requirerole" style="color: inherit; text-decoration: none;">
  <h3>RequireRole</h3>
</a>
<p>Decorator to be used for access control. By default we suppose that all GraphQL resources are accessible to all users. If we want to limit the access to specific resource, we can add RequireRole decorator to resolver annotation. Valid roles are &#39;ADMIN&#39; or &#39;MACHINE&#39;, you can also supply multiple roles that are allowed to access this resource by providing an array like [&#39;ADMIN&#39;, &#39;MACHINE&#39;].</p>
<pre><code><span class="hl-1">@</span><span class="hl-8">RequireRole</span><span class="hl-1">(</span><span class="hl-5">&#39;ADMIN&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">@</span><span class="hl-8">Query</span><span class="hl-1">(</span><span class="hl-0">returns</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-11">String</span><span class="hl-1">)</span><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-8">test</span><span class="hl-1">(): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-0">string</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return </span><span class="hl-5">&#39;I will only be seen by ADMIN&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">}</span>
</code></pre>
<pre><code><span class="hl-1">@</span><span class="hl-8">RequireRole</span><span class="hl-1">([</span><span class="hl-5">&#39;ADMIN&#39;</span><span class="hl-1">, </span><span class="hl-5">&#39;MACHINE&#39;</span><span class="hl-1">])</span><br/><span class="hl-1">@</span><span class="hl-8">Query</span><span class="hl-1">(</span><span class="hl-0">returns</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-11">String</span><span class="hl-1">)</span><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-8">test</span><span class="hl-1">(): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-0">string</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return </span><span class="hl-5">&#39;I will only be seen by ADMIN or MACHINE&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#requireroleatleast" id="requireroleatleast" style="color: inherit; text-decoration: none;">
  <h3>RequireRoleAtLeast</h3>
</a>
<p>Similar to <code>RequireRole</code> decorator but a little different in terms of how it performs role checks. This decorator is used to limit GraphQL resources to users who have at least certain role defined in <a href="https://github.com/equeumco/equeum-graphql-server/blob/master/lib/constants.ts">UserRoles</a>. For example, <code>@RequireRoleAtLeast(&#39;ADMIN&#39;)</code> equivalents to <code>@RequireRole([&#39;ADMIN&#39;, &#39;MACHINE&#39;])</code>.</p>
<pre><code><span class="hl-1">@</span><span class="hl-8">RequireRoleAtLeast</span><span class="hl-1">(</span><span class="hl-5">&#39;ADMIN&#39;</span><span class="hl-1">)</span><br/><span class="hl-1">@</span><span class="hl-8">Query</span><span class="hl-1">(</span><span class="hl-0">returns</span><span class="hl-1"> </span><span class="hl-6">=&gt;</span><span class="hl-1"> </span><span class="hl-11">String</span><span class="hl-1">)</span><br/><span class="hl-0">async</span><span class="hl-1"> </span><span class="hl-8">test</span><span class="hl-1">(): </span><span class="hl-11">Promise</span><span class="hl-1">&lt;</span><span class="hl-0">string</span><span class="hl-1">&gt; {</span><br/><span class="hl-1">  return </span><span class="hl-5">&#39;I will only be seen by ADMIN or MACHINE.&#39;</span><span class="hl-0">;</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#error-handling" id="error-handling" style="color: inherit; text-decoration: none;">
  <h2>Error handling</h2>
</a>
<p>All the errors thrown inside resolvers are returned to user. Currently way too detailed error information is sent back. Error handling is a subject to be upgraded heavily in a near future.</p>
<p>Here are exported error classes you can use in your code for standard error responses.</p>

<a href="#notanownererror" id="notanownererror" style="color: inherit; text-decoration: none;">
  <h3>NotAnOwnerError</h3>
</a>
<p>Error to be thrown when the uswer is not an owner of the entity he is trying to access or change.</p>

<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
  <h2>Documentation</h2>
</a>
<p>Class and type reference can be found under <a href="./docs">/docs</a></p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum"><a href="enums/UserRoles.html" class="tsd-kind-icon">User<wbr/>Roles</a></li><li class="tsd-kind-class"><a href="classes/EqueumContext.html" class="tsd-kind-icon">Equeum<wbr/>Context</a></li><li class="tsd-kind-class"><a href="classes/NotAnOwnerError.html" class="tsd-kind-icon">Not<wbr/>An<wbr/>Owner<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/default.html" class="tsd-kind-icon">default</a></li><li class="tsd-kind-function"><a href="modules.html#RequireRole" class="tsd-kind-icon">Require<wbr/>Role</a></li><li class="tsd-kind-function"><a href="modules.html#RequireRoleAtLeast" class="tsd-kind-icon">Require<wbr/>Role<wbr/>At<wbr/>Least</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>