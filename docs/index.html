<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>equeum-graphql-server</title>
	<meta name="description" content="Documentation for equeum-graphql-server">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
	<script async src="assets/js/search.js" id="search-script"></script>
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">equeum-graphql-server</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<h1>equeum-graphql-server</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#equeum-graphql-server" id="equeum-graphql-server" style="color: inherit; text-decoration: none;">
					<h1>Equeum GraphQL Server</h1>
				</a>
				<p>Implementation of GraphQL server. Takes in type definitions and resolvers and configures GraphQL server with authenticated user data in context and other standard things. Apollo Federation ready. Also exports Equeum specific type definitions.</p>
				<a href="#requirements" id="requirements" style="color: inherit; text-decoration: none;">
					<h2>Requirements</h2>
				</a>
				<p>Scripts inside package.json rely on <a href="https://www.npmjs.com/package/npx">npx</a> to be installed globally. To install it run:</p>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> -</span><span style="color: #001080">g</span><span style="color: #000000"> </span><span style="color: #001080">npx</span>
</code></pre>
				<p>You also need EqueumRESTServer as it provides standard implementation for web service and provides authentification and security.</p>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> </span><span style="color: #001080">git</span><span style="color: #000000">+ssh:</span><span style="color: #008000">//github.com/equeumco/equeum-rest-server.git</span>
</code></pre>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<p>To ensure the stability of our services we always specify exact version of the library that we are including. Therefore we are sure that &#39;npm install&#39; will always install the same version no matter what. Developers then need to update the version for each service manually when that is needed (or together with routinely updating all outdated third-party packages).</p>
				<pre><code><span style="color: #001080">npm</span><span style="color: #000000"> </span><span style="color: #001080">install</span><span style="color: #000000"> </span><span style="color: #001080">git</span><span style="color: #000000">+https:</span><span style="color: #008000">//github.com/equeumco/equeum-graphql-server#X.Y.Z</span>
</code></pre>
				<p>Where &#39;X.Y.Z&#39; is the <a href="../../releases/latest">latest version of the library</a>.</p>
				<a href="#working-example" id="working-example" style="color: inherit; text-decoration: none;">
					<h2>Working example</h2>
				</a>
				<pre><code><span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">express</span><span style="color: #000000">, { </span><span style="color: #001080">Router</span><span style="color: #000000">, </span><span style="color: #001080">Request</span><span style="color: #000000">, </span><span style="color: #001080">Response</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;express&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">EqueumRESTServer</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;equeum-rest-server&#039;</span><span style="color: #000000">;</span>
<span style="color: #AF00DB">import</span><span style="color: #000000"> </span><span style="color: #001080">EqueumGraphQLServer</span><span style="color: #000000"> </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;equeum-graphql-server&#039;</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">app</span><span style="color: #000000"> = </span><span style="color: #795E26">express</span><span style="color: #000000">();</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">typeDefs</span><span style="color: #000000"> = </span><span style="color: #A31515">`</span>
<span style="color: #A31515">  type Query {</span>
<span style="color: #A31515">    testQuery: String</span>
<span style="color: #A31515">  }</span>
<span style="color: #A31515">`</span><span style="color: #000000">;</span>

<span style="color: #0000FF">const</span><span style="color: #000000"> </span><span style="color: #0070C1">resolvers</span><span style="color: #000000"> = {</span>
<span style="color: #000000">  </span><span style="color: #001080">Query:</span><span style="color: #000000"> {</span>
<span style="color: #000000">    </span><span style="color: #795E26">testQuery</span><span style="color: #001080">:</span><span style="color: #000000"> () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;Test response&#039;</span>
<span style="color: #000000">  }</span>
<span style="color: #000000">};</span>

<span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">EqueumRESTServer</span><span style="color: #000000">({</span>
<span style="color: #000000">  </span><span style="color: #001080">app</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #008000">// We need to pass this here to make sure /graphql route is just checked for auth</span>
<span style="color: #000000">  </span><span style="color: #008000">// but not handled by REST server and left for GraphQL server</span>
<span style="color: #000000">  </span><span style="color: #001080">passThroughRoutes:</span><span style="color: #000000"> [</span><span style="color: #A31515">&#039;/graphql&#039;</span><span style="color: #000000">],</span>
<span style="color: #000000">  </span><span style="color: #001080">addAuthToRoutes:</span><span style="color: #000000"> [</span><span style="color: #A31515">&#039;/graphql</span><span style="color: #CD3131">]</span>
<span style="color: #000000">});</span>
<span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">EqueumGraphQLServer</span><span style="color: #000000">({</span>
<span style="color: #000000">  </span><span style="color: #001080">app</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">typeDefs</span><span style="color: #000000">,</span>
<span style="color: #000000">  </span><span style="color: #001080">resolvers</span>
<span style="color: #000000">});</span>

<span style="color: #001080">const</span><span style="color: #000000"> </span><span style="color: #001080">port</span><span style="color: #000000">: </span><span style="color: #001080">number</span><span style="color: #000000"> = </span><span style="color: #098658">4000</span><span style="color: #000000">;</span>
<span style="color: #001080">app</span><span style="color: #000000">.</span><span style="color: #795E26">listen</span><span style="color: #000000">(</span><span style="color: #001080">port</span><span style="color: #000000">, () </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #001080">console</span><span style="color: #000000">.</span><span style="color: #795E26">log</span><span style="color: #000000">(</span><span style="color: #A31515">`Server is listening on http://localhost:</span><span style="color: #0000FF">${</span><span style="color: #001080">port</span><span style="color: #0000FF">}</span><span style="color: #A31515">`</span><span style="color: #000000">));</span>
</code></pre>
				<p>If using <a href="https://typegraphql.ml/">TypeGraphQL</a> for automatically generating schema you first build type definitions and resolvers and then pass them to the constructor.</p>
				<pre><code><span style="color: #AF00DB">import</span><span style="color: #000000"> { </span><span style="color: #001080">buildTypeDefsAndResolvers</span><span style="color: #000000"> } </span><span style="color: #AF00DB">from</span><span style="color: #000000"> </span><span style="color: #A31515">&#039;type-graphql&#039;</span><span style="color: #000000">;</span>

<span style="color: #795E26">buildTypeDefsAndResolvers</span><span style="color: #000000">({ </span><span style="color: #001080">resolvers:</span><span style="color: #000000"> [ ... ] }).</span><span style="color: #795E26">then</span><span style="color: #000000">(({ </span><span style="color: #001080">typeDefs</span><span style="color: #000000">, </span><span style="color: #001080">resolvers</span><span style="color: #000000"> }) </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> {</span>
<span style="color: #000000">  </span><span style="color: #0000FF">new</span><span style="color: #000000"> </span><span style="color: #795E26">EqueumGraphQLServer</span><span style="color: #000000">({</span>
<span style="color: #000000">    </span><span style="color: #001080">app</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">typeDefs</span><span style="color: #000000">,</span>
<span style="color: #000000">    </span><span style="color: #001080">resolvers</span><span style="color: #000000">,</span>
<span style="color: #000000">  });</span>
<span style="color: #000000">});</span>
</code></pre>
				<a href="#equeumgraphqlserver-default-export" id="equeumgraphqlserver-default-export" style="color: inherit; text-decoration: none;">
					<h2>EqueumGraphQLServer (default export)</h2>
				</a>
				<p>Main class containing GraphQL server implementation. <a href="#working-example">Working example</a> has copy-paste ready code to bootsrap the server.</p>
				<a href="#authentification" id="authentification" style="color: inherit; text-decoration: none;">
					<h3>Authentification</h3>
				</a>
				<p>EqueumGraphQL server relies on EqueumRESTServer to verify JWT token and add user data to request object. It expects all requests that pass REST server auth middleware to be authenticated. It then reads user data from request object and populates GraphQL context with that data.</p>
				<a href="#constructor-parameters" id="constructor-parameters" style="color: inherit; text-decoration: none;">
					<h3>Constructor Parameters</h3>
				</a>
				<a href="#app-application" id="app-application" style="color: inherit; text-decoration: none;">
					<h4>app: Application</h4>
				</a>
				<p>Express app object to build the server over</p>
				<a href="#typedefs-any" id="typedefs-any" style="color: inherit; text-decoration: none;">
					<h4>typeDefs: any</h4>
				</a>
				<p>GraphQL type definitions</p>
				<a href="#resolvers-iresolversltany-anygt--iresolversltany-anygt" id="resolvers-iresolversltany-anygt--iresolversltany-anygt" style="color: inherit; text-decoration: none;">
					<h4>resolvers: IResolvers&lt;any, any&gt; | IResolvers&lt;any, any&gt;[]</h4>
				</a>
				<p>Resolver functions</p>
				<a href="#loaders--key-string-dataloaderltstring-anygt-" id="loaders--key-string-dataloaderltstring-anygt-" style="color: inherit; text-decoration: none;">
					<h4>loaders: { [key: string]: DataLoader&lt;string, any&gt; }</h4>
				</a>
				<p>Custom data loaders. We use <a href="https://github.com/graphql/dataloader">DataLoader</a> utility to batch and optimise resolving queries. Loaders passed here will be added to context and available to use in your resolvers.</p>
				<a href="#types" id="types" style="color: inherit; text-decoration: none;">
					<h2>Types</h2>
				</a>
				<a href="#equeumcontext" id="equeumcontext" style="color: inherit; text-decoration: none;">
					<h3>EqueumContext</h3>
				</a>
				<p>This type defines context that will be available inside each resolver.</p>
				<a href="#decorators" id="decorators" style="color: inherit; text-decoration: none;">
					<h2>Decorators</h2>
				</a>
				<a href="#requirerole" id="requirerole" style="color: inherit; text-decoration: none;">
					<h3>RequireRole</h3>
				</a>
				<p>Decorator to be used for access control. By default we suppose that all GraphQL resources are accessible to all users. If we want to limit the access to specific resource, we can add RequireRole decorator to resolver annotation. Valid roles are &#39;ADMIN&#39; or &#39;MACHINE&#39;, you can also supply multiple roles that are allowed to access this resource by providing an array like [&#39;ADMIN&#39;, &#39;MACHINE&#39;].</p>
				<pre><code><span style="color: #000000">@</span><span style="color: #795E26">RequireRole</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;ADMIN&#039;</span><span style="color: #000000">)</span>
<span style="color: #000000">@</span><span style="color: #795E26">Query</span><span style="color: #000000">(</span><span style="color: #001080">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">String</span><span style="color: #000000">)</span>
<span style="color: #001080">async</span><span style="color: #000000"> </span><span style="color: #795E26">test</span><span style="color: #000000">(): </span><span style="color: #267F99">Promise</span><span style="color: #000000">&lt;</span><span style="color: #001080">string</span><span style="color: #000000">&gt; {</span>
<span style="color: #000000">  return </span><span style="color: #A31515">&#039;I will only be seen by ADMIN&#039;</span><span style="color: #001080">;</span>
<span style="color: #001080">}</span>
</code></pre>
				<pre><code><span style="color: #000000">@</span><span style="color: #795E26">RequireRole</span><span style="color: #000000">([</span><span style="color: #A31515">&#039;ADMIN&#039;</span><span style="color: #000000">, </span><span style="color: #A31515">&#039;MACHINE&#039;</span><span style="color: #000000">])</span>
<span style="color: #000000">@</span><span style="color: #795E26">Query</span><span style="color: #000000">(</span><span style="color: #001080">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">String</span><span style="color: #000000">)</span>
<span style="color: #001080">async</span><span style="color: #000000"> </span><span style="color: #795E26">test</span><span style="color: #000000">(): </span><span style="color: #267F99">Promise</span><span style="color: #000000">&lt;</span><span style="color: #001080">string</span><span style="color: #000000">&gt; {</span>
<span style="color: #000000">  return </span><span style="color: #A31515">&#039;I will only be seen by ADMIN or MACHINE&#039;</span><span style="color: #001080">;</span>
<span style="color: #001080">}</span>
</code></pre>
				<a href="#requireroleatleast" id="requireroleatleast" style="color: inherit; text-decoration: none;">
					<h3>RequireRoleAtLeast</h3>
				</a>
				<p>Similar to <code>RequireRole</code> decorator but a little different in terms of how it performs role checks. This decorator is used to limit GraphQL resources to users who have at least certain role defined in <a href="https://github.com/equeumco/equeum-graphql-server/blob/master/lib/constants.ts">UserRoles</a>. For example, <code>@RequireRoleAtLeast(&#39;ADMIN&#39;)</code> equivalents to <code>@RequireRole([&#39;ADMIN&#39;, &#39;MACHINE&#39;])</code>.</p>
				<pre><code><span style="color: #000000">@</span><span style="color: #795E26">RequireRoleAtLeast</span><span style="color: #000000">(</span><span style="color: #A31515">&#039;ADMIN&#039;</span><span style="color: #000000">)</span>
<span style="color: #000000">@</span><span style="color: #795E26">Query</span><span style="color: #000000">(</span><span style="color: #001080">returns</span><span style="color: #000000"> </span><span style="color: #0000FF">=&gt;</span><span style="color: #000000"> </span><span style="color: #267F99">String</span><span style="color: #000000">)</span>
<span style="color: #001080">async</span><span style="color: #000000"> </span><span style="color: #795E26">test</span><span style="color: #000000">(): </span><span style="color: #267F99">Promise</span><span style="color: #000000">&lt;</span><span style="color: #001080">string</span><span style="color: #000000">&gt; {</span>
<span style="color: #000000">  return </span><span style="color: #A31515">&#039;I will only be seen by ADMIN or MACHINE.&#039;</span><span style="color: #001080">;</span>
<span style="color: #001080">}</span>
</code></pre>
				<a href="#error-handling" id="error-handling" style="color: inherit; text-decoration: none;">
					<h2>Error handling</h2>
				</a>
				<p>All the errors thrown inside resolvers are returned to user. Currently way too detailed error information is sent back. Error handling is a subject to be upgraded heavily in a near future.</p>
				<p>Here are exported error classes you can use in your code for standard error responses.</p>
				<a href="#notanownererror" id="notanownererror" style="color: inherit; text-decoration: none;">
					<h3>NotAnOwnerError</h3>
				</a>
				<p>Error to be thrown when the uswer is not an owner of the entity he is trying to access or change.</p>
				<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
					<h2>Documentation</h2>
				</a>
				<p>Class and type reference can be found under <a href="./docs">/docs</a></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class=" ">
						<a href="modules.html">Exports</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/equeumgraphqlserver.html">Equeum<wbr>GraphQLServer</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/constants.html">constants</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/decorators.html">decorators</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/decorators_requirerole.html">decorators/<wbr>Require<wbr>Role</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/decorators_requireroleatleast.html">decorators/<wbr>Require<wbr>Role<wbr>AtLeast</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/entities.html">entities</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/entities_notanownererror.html">entities/<wbr>Not<wbr>AnOwner<wbr>Error</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/index.html">index</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/types.html">types</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/types_authenticateduserdata.html">types/<wbr>Authenticated<wbr>User<wbr>Data</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/types_equeumcontext.html">types/<wbr>Equeum<wbr>Context</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/types_equeumgraphqlserverparams.html">types/<wbr>Equeum<wbr>GraphQLServer<wbr>Params</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils.html">utils</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/utils_getpackageversion.html">utils/get<wbr>Package<wbr>Version</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>