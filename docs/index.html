<!doctype html>
<html class="default no-js">
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>equeum-graphql-server</title>
	<meta name="description" content="Documentation for equeum-graphql-server">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="assets/css/main.css">
</head>
<body>
<header>
	<div class="tsd-page-toolbar">
		<div class="container">
			<div class="table-wrap">
				<div class="table-cell" id="tsd-search" data-index="assets/js/search.json" data-base=".">
					<div class="field">
						<label for="tsd-search-field" class="tsd-widget search no-caption">Search</label>
						<input id="tsd-search-field" type="text" />
					</div>
					<ul class="results">
						<li class="state loading">Preparing search index...</li>
						<li class="state failure">The search index is not available</li>
					</ul>
					<a href="index.html" class="title">equeum-graphql-server</a>
				</div>
				<div class="table-cell" id="tsd-widgets">
					<div id="tsd-filter">
						<a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a>
						<div class="tsd-filter-group">
							<div class="tsd-select" id="tsd-filter-visibility">
								<span class="tsd-select-label">All</span>
								<ul class="tsd-select-list">
									<li data-value="public">Public</li>
									<li data-value="protected">Public/Protected</li>
									<li data-value="private" class="selected">All</li>
								</ul>
							</div>
							<input type="checkbox" id="tsd-filter-inherited" checked />
							<label class="tsd-widget" for="tsd-filter-inherited">Inherited</label>
							<input type="checkbox" id="tsd-filter-externals" checked />
							<label class="tsd-widget" for="tsd-filter-externals">Externals</label>
							<input type="checkbox" id="tsd-filter-only-exported" />
							<label class="tsd-widget" for="tsd-filter-only-exported">Only exported</label>
						</div>
					</div>
					<a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a>
				</div>
			</div>
		</div>
	</div>
	<div class="tsd-page-title">
		<div class="container">
			<ul class="tsd-breadcrumb">
				<li>
					<a href="globals.html">Globals</a>
				</li>
			</ul>
			<h1>equeum-graphql-server</h1>
		</div>
	</div>
</header>
<div class="container container-main">
	<div class="row">
		<div class="col-8 col-content">
			<div class="tsd-panel tsd-typography">
				<a href="#equeum-graphql-server" id="equeum-graphql-server" style="color: inherit; text-decoration: none;">
					<h1>Equeum GraphQL Server</h1>
				</a>
				<p>Implementation of GraphQL server. Takes in type definitions and resolvers and configures GraphQL server with authenticated user data in context and other standard things. Apollo Federation ready. Also exports Equeum specific type definitions.</p>
				<a href="#requirements" id="requirements" style="color: inherit; text-decoration: none;">
					<h2>Requirements</h2>
				</a>
				<p>Scripts inside package.json rely on <a href="https://www.npmjs.com/package/npx">npx</a> to be installed globally. To install it run:</p>
				<pre><code>npm <span class="hljs-keyword">install</span> -g npx</code></pre>
				<p>You also need EqueumRESTServer as it provides standard implementation for web service and provides authentification and security.</p>
				<pre><code>npm install git+ssh:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/equeumco/</span>equeum-rest-server.git</code></pre>
				<a href="#installation" id="installation" style="color: inherit; text-decoration: none;">
					<h2>Installation</h2>
				</a>
				<p>To ensure the stability of our services we always specify exact version of the library that we are including. Therefore we are sure that &#39;npm install&#39; will always install the same version no matter what. Developers then need to update the version for each service manually when that is needed (or together with routinely updating all outdated third-party packages).</p>
				<pre><code>npm install git+https:<span class="hljs-regexp">//gi</span>thub.com<span class="hljs-regexp">/equeumco/</span>equeum-graphql-server<span class="hljs-comment">#X.Y.Z</span></code></pre>
				<p>Where &#39;X.Y.Z&#39; is the <a href="../../releases/latest">latest version of the library</a>.</p>
				<a href="#working-example" id="working-example" style="color: inherit; text-decoration: none;">
					<h2>Working example</h2>
				</a>
				<pre><code><span class="hljs-keyword">import</span> express, { Router, Request, Response } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;express&#x27;</span>;
<span class="hljs-keyword">import</span> EqueumRESTServer <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;equeum-rest-server&#x27;</span>;
<span class="hljs-keyword">import</span> EqueumGraphQLServer <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;equeum-graphql-server&#x27;</span>;

const app = express();

const typeDefs = `
  <span class="hljs-keyword">type</span> Query {
    testQuery: String
  }
`;

const resolvers = {
  Query: {
    testQuery: () =&gt; <span class="hljs-string">&#x27;Test response&#x27;</span>
  }
};

<span class="hljs-built_in">new</span> EqueumRESTServer({
  app,
  // We need <span class="hljs-keyword">to</span> pass this here <span class="hljs-keyword">to</span> make sure /graphql route <span class="hljs-keyword">is</span> just checked <span class="hljs-keyword">for</span> auth
  // but <span class="hljs-keyword">not</span> handled <span class="hljs-keyword">by</span> REST <span class="hljs-keyword">server</span> <span class="hljs-keyword">and</span> left <span class="hljs-keyword">for</span> GraphQL <span class="hljs-keyword">server</span>
  passThroughRoutes: [<span class="hljs-string">&#x27;/graphql&#x27;</span>],
  addAuthToRoutes: [<span class="hljs-string">&#x27;/graphql]
});
new EqueumGraphQLServer({
  app,
  typeDefs,
  resolvers
});

const port: number = 4000;
app.listen(port, () =&gt; console.log(`Server is listening on http://localhost:${port}`));</span></code></pre>
				<p>If using <a href="https://typegraphql.ml/">TypeGraphQL</a> for automatically generating schema you first build type definitions and resolvers and then pass them to the constructor.</p>
				<pre><code><span class="hljs-keyword">import</span> { buildTypeDefsAndResolvers } <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;type-graphql&#x27;</span>;

buildTypeDefsAndResolvers({ <span class="hljs-attr">resolvers</span>: [ ... ] }).then(<span class="hljs-function">(<span class="hljs-params">{ typeDefs, resolvers }</span>) =&gt;</span> {
  <span class="hljs-keyword">new</span> EqueumGraphQLServer({
    app,
    typeDefs,
    resolvers,
  });
});</code></pre>
				<a href="#equeumgraphqlserver-default-export" id="equeumgraphqlserver-default-export" style="color: inherit; text-decoration: none;">
					<h2>EqueumGraphQLServer (default export)</h2>
				</a>
				<p>Main class containing GraphQL server implementation. <a href="#working-example">Working example</a> has copy-paste ready code to bootsrap the server.</p>
				<a href="#authentification" id="authentification" style="color: inherit; text-decoration: none;">
					<h3>Authentification</h3>
				</a>
				<p>EqueumGraphQL server relies on EqueumRESTServer to verify JWT token and add user data to request object. It expects all requests that pass REST server auth middleware to be authenticated. It then reads user data from request object and populates GraphQL context with that data.</p>
				<a href="#constructor-parameters" id="constructor-parameters" style="color: inherit; text-decoration: none;">
					<h3>Constructor Parameters</h3>
				</a>
				<a href="#app-application" id="app-application" style="color: inherit; text-decoration: none;">
					<h4>app: Application</h4>
				</a>
				<p>Express app object to build the server over</p>
				<a href="#typedefs-any" id="typedefs-any" style="color: inherit; text-decoration: none;">
					<h4>typeDefs: any</h4>
				</a>
				<p>GraphQL type definitions</p>
				<a href="#resolvers-iresolversltany-anygt--iresolversltany-anygt" id="resolvers-iresolversltany-anygt--iresolversltany-anygt" style="color: inherit; text-decoration: none;">
					<h4>resolvers: IResolvers&lt;any, any&gt; | IResolvers&lt;any, any&gt;[]</h4>
				</a>
				<p>Resolver functions</p>
				<a href="#loaders--key-string-dataloaderltstring-anygt-" id="loaders--key-string-dataloaderltstring-anygt-" style="color: inherit; text-decoration: none;">
					<h4>loaders: { [key: string]: DataLoader&lt;string, any&gt; }</h4>
				</a>
				<p>Custom data loaders. We use <a href="https://github.com/graphql/dataloader">DataLoader</a> utility to batch and optimise resolving queries. Loaders passed here will be added to context and available to use in your resolvers.</p>
				<a href="#useragent-object" id="useragent-object" style="color: inherit; text-decoration: none;">
					<h4>userAgent: object</h4>
				</a>
				<p>Requested user&#39;s system and browser information. We use <a href="https://github.com/3rd-Eden/useragent">useragent</a> to parse this information from request headers. </p>
				<a href="#types" id="types" style="color: inherit; text-decoration: none;">
					<h2>Types</h2>
				</a>
				<a href="#equeumcontext" id="equeumcontext" style="color: inherit; text-decoration: none;">
					<h3>EqueumContext</h3>
				</a>
				<p>This type defines context that will be available inside each resover.</p>
				<a href="#decorators" id="decorators" style="color: inherit; text-decoration: none;">
					<h2>Decorators</h2>
				</a>
				<a href="#requirerole" id="requirerole" style="color: inherit; text-decoration: none;">
					<h3>RequireRole</h3>
				</a>
				<p>Decorator to be used for access control. By default we suppose that all GraphQL resources are accessible to all users. If we want to limit the access to specific resource, we can add RequireROle decorator to resolver annotation. Valid roles are &#39;ADMIN&#39; or &#39;MACHINE&#39;, you can also supply multiple roles that are allowed to access this resource by providing an array like [&#39;ADMIN&#39;, &#39;MACHINE&#39;].</p>
				<pre><code><span class="hljs-meta">@RequireRole</span>(<span class="hljs-string">&#x27;ADMIN&#x27;</span>)
<span class="hljs-meta">@Query</span>(<span class="hljs-function"><span class="hljs-params">returns</span> =&gt;</span> <span class="hljs-built_in">String</span>)
<span class="hljs-keyword">async</span> test(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;I will only be seen by ADMIN&#x27;</span>;
}</code></pre>
				<pre><code><span class="hljs-meta">@RequireRole</span>([<span class="hljs-string">&#x27;ADMIN&#x27;</span>, <span class="hljs-string">&#x27;MACHINE&#x27;</span>])
<span class="hljs-meta">@Query</span>(<span class="hljs-function"><span class="hljs-params">returns</span> =&gt;</span> <span class="hljs-built_in">String</span>)
<span class="hljs-keyword">async</span> test(): <span class="hljs-built_in">Promise</span>&lt;<span class="hljs-built_in">string</span>&gt; {
  <span class="hljs-keyword">return</span> <span class="hljs-string">&#x27;I will only be seen by ADMIN or MACHINE&#x27;</span>;
}</code></pre>
				<a href="#error-handling" id="error-handling" style="color: inherit; text-decoration: none;">
					<h2>Error handling</h2>
				</a>
				<p>All the errors thrown inside resolvers are returned to user. Currently way too detailed error information is sent back. Error handling is a subject to be upgraded heavily in a near future.</p>
				<p>Here are exported error classes you can use in your code for standard error responses.</p>
				<a href="#notanownererror" id="notanownererror" style="color: inherit; text-decoration: none;">
					<h3>NotAnOwnerError</h3>
				</a>
				<p>Error to be thrown when the uswer is not an owner of the entity he is trying to access or change.</p>
				<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
					<h2>Documentation</h2>
				</a>
				<p>Class and type reference can be found under <a href="./docs">/docs</a></p>
			</div>
		</div>
		<div class="col-4 col-menu menu-sticky-wrap menu-highlight">
			<nav class="tsd-navigation primary">
				<ul>
					<li class="globals  ">
						<a href="globals.html"><em>Globals</em></a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_equeumgraphqlserver_.html">&quot;lib/<wbr>Equeum<wbr>GraphQLServer&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_constants_.html">&quot;lib/constants&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_decorators_requirerole_.html">&quot;lib/decorators/<wbr>Require<wbr>Role&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_decorators_requireroleatleast_.html">&quot;lib/decorators/<wbr>Require<wbr>Role<wbr>AtLeast&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_decorators_index_.html">&quot;lib/decorators/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_entities_notanownererror_.html">&quot;lib/entities/<wbr>Not<wbr>AnOwner<wbr>Error&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_entities_index_.html">&quot;lib/entities/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_index_.html">&quot;lib/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_types_authenticateduserdata_.html">&quot;lib/types/<wbr>Authenticated<wbr>User<wbr>Data&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_types_equeumcontext_.html">&quot;lib/types/<wbr>Equeum<wbr>Context&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_types_equeumgraphqlserverparams_.html">&quot;lib/types/<wbr>Equeum<wbr>GraphQLServer<wbr>Params&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_types_index_.html">&quot;lib/types/index&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_utils_getpackageversion_.html">&quot;lib/utils/get<wbr>Package<wbr>Version&quot;</a>
					</li>
					<li class=" tsd-kind-module">
						<a href="modules/_lib_utils_index_.html">&quot;lib/utils/index&quot;</a>
					</li>
				</ul>
			</nav>
			<nav class="tsd-navigation secondary menu-sticky">
				<ul class="before-current">
				</ul>
			</nav>
		</div>
	</div>
</div>
<footer class="with-border-bottom">
	<div class="container">
		<h2>Legend</h2>
		<div class="tsd-legend-group">
			<ul class="tsd-legend">
				<li class="tsd-kind-variable"><span class="tsd-kind-icon">Variable</span></li>
				<li class="tsd-kind-function"><span class="tsd-kind-icon">Function</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-enum"><span class="tsd-kind-icon">Enumeration</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-interface"><span class="tsd-kind-icon">Interface</span></li>
			</ul>
			<ul class="tsd-legend">
				<li class="tsd-kind-class"><span class="tsd-kind-icon">Class</span></li>
			</ul>
		</div>
	</div>
</footer>
<div class="container tsd-generator">
	<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p>
</div>
<div class="overlay"></div>
<script src="assets/js/main.js"></script>
</body>
</html>